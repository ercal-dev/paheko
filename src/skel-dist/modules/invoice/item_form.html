{{:admin_header title="Ajouter un article au devis"}}

<script type="text/javascript">
function add_item() {
	const DEVISE = '{{$config.currency|htmlspecialchars|args:ENT_QUOTES}}';
	let row_line;
	let row_index;
	let td;
	let item_properties = ['name', 'description', 'unit_price', 'quantity'];
	let value;
	let input;
	let total;

	row_line = document.createElement('tr');
	row_line.classList.add('item');
	row_index = window.parent.document.getElementById('item_list').children.length - 1;
	for (let i = 0; i < 4; ++i) {
		td = document.createElement('td');
		td.classList.add('item_' + item_properties[i]);
		value = document.getElementById('item_' + item_properties[i]).value;
		input = document.createElement('input');
		input.type = 'hidden';
		input.name = 'items[' + row_index + '][' + item_properties[i] + ']';
		input.id = 'item_' + item_properties[i] + '_' + row_index;
		input.value = value;
		td.appendChild(input);
		td.appendChild(document.createTextNode(value));
		row_line.appendChild(td);
	}
	window.parent.document.getElementById('item_list_no_item_message').style.display = 'none';
	window.parent.document.getElementById('item_list').style.display = 'block';
	window.parent.document.getElementById('item_list').appendChild(row_line);
	total = computeTotal();
	window.parent.document.getElementById('quotation_total').textContent = parseFloat(total) + ' ' + DEVISE;
	window.parent.document.getElementById('quotation_total_input').value = parseFloat(total);
	window.parent.g.closeDialog();
}

function computeTotal() {
	let items = window.parent.document.getElementById('item_list').getElementsByClassName('item');
	let total = 0.0;

	for (let i = 0; i < items.length; ++i) {
		if (!isNaN(items[i].children[2].textContent) && !isNaN(items[i].children[3].textContent))
			total += parseFloat(items[i].children[2].textContent) * parseFloat(items[i].children[3].textContent);
	}
	return total;
}
</script>

<form method="POST" action="" id="item_creation_form">
	<fieldset>
		<legend>Ajouter un article</legend>
		<ul>
			<li><label for="item_name">Dénomination</label><input type="text" name="item_name" id="item_name" label="" placeholder="ex : barnum" value="" /></li>
			<li><label for="item_description">Description</label><textarea name="item_description" id="item_description" label="" placeholder=""></textarea></li>
			<li><label for="item_unit_price">Prix unitaire</label><input type="text" name="item_unit_price" id="item_unit_price" label="" placeholder="" value="" /></li>
			<li><label for="item_quantity">Quantité</label><input type="text" name="item_quantity" id="item_quantity" label="" placeholder="" value="1" /></li>
		</ul>
		<input type="button" name="" id="item_addition_button" onclick="add_item()" value="Ajouter l'article au devis" />
	</fieldset>
</form>

{{:admin_footer}}
