<nav class="tabs">
	<aside class="menu">
		<ul>
			{{if $type === $QUOTATION_TYPE}}
				<li class="followed_by_separator">
					<form method="POST" action="edit.html?show=quotation&step=start">
						{{:button type="submit" label="Nouveau" shape="plus" name="new_button" class="main_action"}}
					</form>
				</li>
			
				{{if $status === $DRAFT_STATUS}}
					<li>{{:linkbutton href="preview.html?id=%s&source=details"|args:$id label="Aperçu papier" shape="document"}}</li>
					{{if !$cancelled}}
						<li>
							<form method="POST" action="{{"./edit.html?show=quotation&id=%d&step=start"|args:$id}}">
								{{:button type="submit" label="Modifier" shape="edit" name="edit_button" class="main_action"}}
							</form>
						</li>
						{{if $_GET.action !== 'sign'}}
							<li>
								<form method="POST" action="{{"action.html?id=%d&show=quotation&action=sign"|args:$id}}">
									{{:button type="submit" label="Finaliser" shape="check" name="signing_button" class="main_action"}}
								</form>
							</li>
						{{/if}}
					{{/if}}

				{{else}}
					<li>{{:linkbutton label="PDF" href="preview.html?id=%s&source=details"|args:$id shape="pdf"}}</li>
					{{if $status === $AWAITING_STATUS}}
						<li>
							<form method="POST" action="{{"action.html?id=%d&show=%s&action=ask_validation"|args:$id:$type}}">
								{{:button type="submit" label="Générer facture" shape="export" name="validation_button" class="main_action"}}
							</form>
						</li>
					{{/if}}
					{{if $status === $VALIDATED_STATUS}}
						<li>
							<form method="POST" action="{{"action.html?id=%d&show=%s&action=ask_invoice_generation"|args:$id:$type}}">
								{{:button type="submit" label="Générer facture" shape="export" name="invoice_generation_button" class="main_action"}}
							</form>
						</li>
					{{/if}}
				{{/if}}
			{{else}}
				<li class="followed_by_separator">
					<form method="POST" action="edit.html?show=quotation">
						{{:button type="submit" label="Nouveau devis" shape="plus" name="new_button" class="main_action"}}
					</form>
				</li>
				{{if $status !== $DRAFT_STATUS}}
					<li>{{:linkbutton label="PDF" href="preview.html?id=%s&source=details"|args:$id shape="pdf"}}</li>
				{{/if}}
			{{/if}}
			
			{{* Deletion *}}
			{{if $status === $DRAFT_STATUS}}
				{{if $_GET.action !== 'ask_deletion'}}
					<li>
						<form method="POST" action="{{"action.html?id=%d&show=%s&action=ask_deletion"|args:$id:$type}}">
							{{:button type="submit" label="Supprimer" shape="delete" class="main_action" name="delete_button"}}
						</form>
					</li>
				{{/if}}
			{{/if}}
			
			{{* Cancellation *}}
			{{if $status !== $DRAFT_STATUS && !$cancelled && !$archived && $_GET.action !== 'ask_cancelling'}}
				{{if $type === $QUOTATION_TYPE}}
					{{:assign button_target_label='le devis'}}
				{{else}}
					{{:assign button_target_label='la facture'}}
				{{/if}}
				<li>
					<form method="POST" action="{{"action.html?id=%d&show=%s&action=ask_cancelling"|args:$id:$type}}">
						{{:button type="submit" label="Annuler %s"|args:$button_target_label shape="delete" class="main_action" name="cancel_button"}}
					</form>
				</li>
			{{/if}}
			
			{{* Archiving *}}
			{{if $status !== $DRAFT_STATUS}}
				{{if $type === $INVOICE_TYPE && $status !== $AWAITING_STATUS}}
					{{:assign invoice_and_not_awaiting_payment=true}}
				{{/if}}
				{{if $type === $QUOTATION_TYPE}}
					{{if $cancelled || $status !== $AWAITING_STATUS}}
						{{:assign quotation_and_archivable=true}}
					{{/if}}
				{{/if}}
				{{if $type === $INVOICE_TYPE && $status === $AWAITING_STATUS && $cancelled}}
					{{:assign invoice_and_not_paid_and_cancelled=true}}
				{{/if}}
				{{if $invoice_and_not_awaiting_payment || $quotation_and_archivable || $invoice_and_not_paid_and_cancelled}}
					<li>
						{{if !$archived && $_GET.action !== 'ask_archiving'}}
							<form method="POST" action="{{"action.html?id=%d&show=%s&action=ask_archiving"|args:$id:$type}}">
								{{:button type="submit" label="Archiver" shape="lock" name="archive_button" class="main_action"}}
							</form>
						{{elseif $archived && $_GET.action !== 'ask_unarchiving'}}
							<form method="POST" action="{{"action.html?id=%d&show=%s&action=ask_unarchiving"|args:$id:$type}}">
								{{:button type="submit" label="Dés-archiver" title="Sortir le document des archives" shape="unlock" name="archive_button" class="main_action"}}
							</form>
						{{/if}}
					</li>
				{{/if}}
			{{/if}}
		</ul>
	</aside>
	{{:include file='./main_nav_tabs.html'}}
</nav>
