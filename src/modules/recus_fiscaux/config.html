{{:admin_header title="Configuration des reçus fiscaux"}}

{{:include file="./_config_default.tpl" keep="module.config"}}

{{if $_POST.save}}
	{{if $_POST.objet_asso|trim == ''}}
		{{:assign error="L'objet de l'association n'a pas été renseigné."}}
	{{elseif !$_POST.comptes_don|count}}
		{{:assign error="Aucun compte de don éligible aux reçus n'a été renseigné."}}
	{{elseif !$_POST.comptes_especes|count}}
		{{:assign error="Aucun compte d'espèces n'a été renseigné."}}
	{{elseif !$_POST.comptes_cheques|count}}
		{{:assign error="Aucun compte de chèques n'a été renseigné."}}
	{{else}}
		{{:save key="config"
			objet_asso=$_POST.objet_asso
			type_asso=$_POST.type_asso
			comptes_don=$_POST.comptes_don
			comptes_don_nature=$_POST.comptes_don_nature
			comptes_especes=$_POST.comptes_especes
			comptes_cheques=$_POST.comptes_cheques
			art200=$_POST.art200
			art238=$_POST.art238
			art885=$_POST.art885
			champs_adresse=$_POST.champs_adresse
		}}
		{{:http redirect="?ok=1"}}
	{{/if}}
{{/if}}

{{if !$dialog}}
<nav class="tabs">
	{{:linkbutton shape="left" href="./" label="Gestion des reçus"}}
</nav>
{{/if}}

{{if $error}}
	<p class="error block">{{$error}}</p>
{{elseif $_GET.ok}}
	<p class="block confirm">Configuration enregistrée.</p>
{{/if}}

<form method="post" action="">

<p class="help">Toute modification ne s'appliquera qu'aux reçus créés, pas aux reçus existants, qui ne peuvent être modifiés pour des raisons légales.</p>

<fieldset>
	<legend>Configuration du modèle de reçu fiscal</legend>
	<dl>
		{{:input required=true name="objet_asso" type="textarea" label="Objet de l'association" source=$module.config cols="70" rows="4" help="Inscrire ici l'objet de l'association, conformément aux statuts."}}
{{*
		{{:input type="checkbox" name="envoi_auto" value=1 label="Envoyer automatiquement le reçu par e-mail"}}
		<dd class="help">Si cette case est cochée, chaque reçu créé sera automatiquement envoyé par e-mail au membre</dd>
*}}
		{{:input type="list" required=true name="comptes_don" label="Comptes éligibles aux reçus" source=$module.config target="!acc/charts/accounts/selector.php?targets=6&key=code" multiple=true}}
		<dd class="help">
			Pour chaque compte indiqué dans ce champ, le reçu de don sera proposé (en dessous de la fiche de l'écriture).
		</dd>
		{{:input type="list" required=true name="comptes_don_nature" label="Comptes de don en nature" source=$module.config target="!acc/charts/accounts/selector.php?targets=6&key=code" multiple=true}}
		<dd class="help">
			Par exemple <tt>75412</tt> pour les abandons de frais par les bénévoles. Utilisé pour cocher automatiquement la bonne case dans le reçu.
		</dd>
		{{:input required=true name="comptes_especes" type="list" multiple=true label="Comptes de caisse" source=$module.config target="!acc/charts/accounts/selector.php?targets=2&key=code"}}
		<dd class="help">
			Par exemple <tt>530</tt>. Utilisé pour cocher automatiquement la bonne case dans le reçu.
		</dd>
		{{:input required=true name="comptes_cheques" type="list" multiple=true label="Comptes pour les chèques" source=$module.config target="!acc/charts/accounts/selector.php?targets=3&key=code"}}
		<dd class="help">
			Par exemple <tt>5112</tt>. Utilisé pour cocher automatiquement la bonne case dans le reçu.
		</dd>
		<dt>Réduction d'impôt éligibles&nbsp;:</dt>
		{{:input type="checkbox" name="art200" value="1" source=$module.config label="Article 200"}}
		{{:input type="checkbox" name="art238" value="1" source=$module.config label="Article 238 bis"}}
		{{:input type="checkbox" name="art885" value="1" source=$module.config label="Article 885-0V bis A"}}
		<dt>Champs à utiliser pour l'adresse du reçu&nbsp;:</dt>
		{{#select name, label FROM config_users_fields WHERE type IN ('text', 'country', 'textarea') ORDER BY sort_order}}
			{{:assign var="checked" from="module.config.champs_adresse.%s"|args:$name}}
			<dd>{{:input type="checkbox" name="champs_adresse[%s]"|args:$name value=$name label=$label source=$module.config default=$checked}}</dd>
		{{/select}}
	</dl>
</fieldset>

<p class="submit">
	{{:button type="submit" name="save" label="Enregistrer" shape="right" class="main"}}
</p>

</form>

{{:admin_footer}}